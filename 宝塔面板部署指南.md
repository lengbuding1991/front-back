# DeepSeek Chat åº”ç”¨å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°
- **é¡¹ç›®åç§°**: DeepSeek Chat åº”ç”¨
- **åŸŸå**: deepseek.lbuding.com
- **æŠ€æœ¯æ ˆ**: Vue.js + FastAPI + Supabase
- **éƒ¨ç½²æ–¹å¼**: å‰åç«¯åˆ†ç¦»éƒ¨ç½²

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„
```
front-back/
â”œâ”€â”€ backend/           # åç«¯APIæœåŠ¡
â”‚   â”œâ”€â”€ main.py       # ä¸»åº”ç”¨æ–‡ä»¶
â”‚   â”œâ”€â”€ run.py        # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ requirements.txt # Pythonä¾èµ–
â”‚   â”œâ”€â”€ .env          # ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ venv/         # Pythonè™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ frontend/         # å‰ç«¯Vueåº”ç”¨
â”‚   â”œâ”€â”€ dist/         # æ„å»ºè¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ src/          # æºä»£ç 
â”‚   â””â”€â”€ package.json  # Node.jsä¾èµ–
â””â”€â”€ éƒ¨ç½²é…ç½®æ–‡ä»¶
    â”œâ”€â”€ deploy-config.json
    â”œâ”€â”€ nginx-deepseek.conf
    â””â”€â”€ å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—.md
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡
1. **ç™»å½•å®å¡”é¢æ¿**ï¼Œç¡®ä¿å·²å®‰è£…ï¼š
   - Nginx 1.20+
   - Python 3.11+
   - Node.js 16+

2. **åˆ›å»ºç½‘ç«™**ï¼š
   - åŸŸåï¼šdeepseek.lbuding.com
   - æ ¹ç›®å½•ï¼š/www/wwwroot/deepseek.lbuding.com
   - PHPç‰ˆæœ¬ï¼šçº¯é™æ€ï¼ˆä¸éœ€è¦PHPï¼‰

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶
1. **ä¸Šä¼ å‰ç«¯æ–‡ä»¶**ï¼š
   ```bash
   # å°† frontend/dist ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ°ç½‘ç«™æ ¹ç›®å½•
   /www/wwwroot/deepseek.lbuding.com/
   ```

2. **ä¸Šä¼ åç«¯æ–‡ä»¶**ï¼š
   ```bash
   # åˆ›å»ºåç«¯ç›®å½•
   mkdir -p /www/server/deepseek-backend
   
   # ä¸Šä¼  backend ç›®å½•åˆ°æœåŠ¡å™¨
   /www/server/deepseek-backend/
   ```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®åç«¯æœåŠ¡
1. **è¿›å…¥åç«¯ç›®å½•**ï¼š
   ```bash
   cd /www/server/deepseek-backend
   ```

2. **åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ**ï¼š
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

3. **å®‰è£…ä¾èµ–**ï¼š
   ```bash
   pip install -r requirements.txt
   ```

4. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   # ç¡®ä¿ .env æ–‡ä»¶å·²ä¸Šä¼ ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®ï¼š
   SUPABASE_URL=æ‚¨çš„Supabase URL
   SUPABASE_KEY=æ‚¨çš„Supabase APIå¯†é’¥
   DASHSCOPE_API_KEY=æ‚¨çš„é˜¿é‡Œäº‘APIå¯†é’¥
   DASHSCOPE_APP_ID=æ‚¨çš„åº”ç”¨ID
   ```

### ç¬¬å››æ­¥ï¼šé…ç½®å®å¡”é¢æ¿
1. **ç½‘ç«™è®¾ç½®** â†’ **é…ç½®æ–‡ä»¶**ï¼š
   - å°† `nginx-deepseek.conf` å†…å®¹å¤åˆ¶åˆ°é…ç½®æ–‡ä»¶ä¸­
   - ä¿å­˜å¹¶é‡è½½Nginx

2. **SSLè¯ä¹¦**ï¼š
   - åœ¨å®å¡”é¢æ¿ç”³è¯·SSLè¯ä¹¦
   - å¯ç”¨HTTPSå¼ºåˆ¶è·³è½¬

3. **åå‘ä»£ç†**ï¼ˆå¦‚æœä½¿ç”¨å®å¡”çš„åä»£åŠŸèƒ½ï¼‰ï¼š
   - ç›®æ ‡URLï¼šhttp://127.0.0.1:8000
   - å‘é€åŸŸåï¼šdeepseek.lbuding.com

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡ï¼ˆè§£å†³ç»ˆç«¯å…³é—­æœåŠ¡åœæ­¢é—®é¢˜ï¼‰

#### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å®å¡”çš„Supervisorç®¡ç†å™¨ï¼ˆæ¨èï¼‰
1. **æ‰“å¼€å®å¡”é¢æ¿** â†’ **è½¯ä»¶å•†åº—** â†’ **Supervisorç®¡ç†å™¨**
2. **æ·»åŠ å®ˆæŠ¤è¿›ç¨‹**ï¼š
   - åç§°ï¼šdeepseek-backend
   - å¯åŠ¨ç”¨æˆ·ï¼šwww
   - è¿è¡Œç›®å½•ï¼š/www/server/deepseek-backend
   - å¯åŠ¨å‘½ä»¤ï¼š
     ```bash
     /www/server/deepseek-backend/venv/bin/python3 run.py
     ```
   - ç¯å¢ƒå˜é‡ï¼šENVIRONMENT=production

3. **å¯åŠ¨æœåŠ¡**ï¼šç‚¹å‡»"å¯åŠ¨"æŒ‰é’®

#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨nohupåå°è¿è¡Œ
```bash
# è¿›å…¥åç«¯ç›®å½•
cd /www/server/deepseek-backend

# ä½¿ç”¨nohupåå°è¿è¡Œï¼Œå¹¶é‡å®šå‘æ—¥å¿—
nohup source venv/bin/activate && ENVIRONMENT=production python3 run.py > backend.log 2>&1 &

# æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œ
ps aux | grep python
```

#### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨systemdæœåŠ¡ï¼ˆLinuxç³»ç»Ÿï¼‰
1. **åˆ›å»ºæœåŠ¡æ–‡ä»¶**ï¼š
   ```bash
   sudo nano /etc/systemd/system/deepseek-backend.service
   ```

2. **æ·»åŠ ä»¥ä¸‹å†…å®¹**ï¼š
   ```ini
   [Unit]
   Description=DeepSeek Backend Service
   After=network.target
   
   [Service]
   Type=simple
   User=www
   WorkingDirectory=/www/server/deepseek-backend
   Environment=ENVIRONMENT=production
   ExecStart=/www/server/deepseek-backend/venv/bin/python3 run.py
   Restart=always
   RestartSec=3
   
   [Install]
   WantedBy=multi-user.target
   ```

3. **å¯åŠ¨æœåŠ¡**ï¼š
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable deepseek-backend
   sudo systemctl start deepseek-backend
   sudo systemctl status deepseek-backend
   ```

#### æ–¹æ¡ˆå››ï¼šä½¿ç”¨PM2ç®¡ç†å™¨
```bash
# å®‰è£…PM2
npm install pm2 -g

# å¯åŠ¨åç«¯æœåŠ¡
cd /www/server/deepseek-backend
pm2 start run.py --name deepseek-backend --interpreter venv/bin/python3

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 save
pm2 startup
```

### ç¬¬å…­æ­¥ï¼šæµ‹è¯•éƒ¨ç½²
1. **å‰ç«¯æµ‹è¯•**ï¼šè®¿é—® https://deepseek.lbuding.com
2. **APIæµ‹è¯•**ï¼šè®¿é—® https://deepseek.lbuding.com/api/docs
3. **å¥åº·æ£€æŸ¥**ï¼šè®¿é—® https://deepseek.lbuding.com/health

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### Nginxé…ç½®è¦ç‚¹
- **é™æ€æ–‡ä»¶ç¼“å­˜**ï¼šCSS/JS/å›¾ç‰‡ç­‰èµ„æºç¼“å­˜1å¹´
- **APIä»£ç†**ï¼š/api/ è·¯å¾„ä»£ç†åˆ°åç«¯æœåŠ¡
- **å®‰å…¨å¤´è®¾ç½®**ï¼šX-Frame-Options, XSSä¿æŠ¤ç­‰
- **HTTPSå¼ºåˆ¶**ï¼šå¯ç”¨SSLå’ŒHTTP/2

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# Supabaseé…ç½®
SUPABASE_URL=https://nkuhiyeeccswaggcxgga.supabase.co
SUPABASE_KEY=æ‚¨çš„APIå¯†é’¥

# é˜¿é‡Œäº‘ç™¾ç‚¼é…ç½®
DASHSCOPE_API_KEY=æ‚¨çš„APIå¯†é’¥
DASHSCOPE_APP_ID=c3e3bac8de9e47e2bc26cb30b6b459e2
```

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### åç«¯æœåŠ¡æ— æ³•å¯åŠ¨
1. æ£€æŸ¥Pythonè™šæ‹Ÿç¯å¢ƒæ˜¯å¦æ­£ç¡®åˆ›å»º
2. ç¡®è®¤æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…
3. éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
4. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š/www/wwwlogs/deepseek.lbuding.com.error.log

### å‰ç«¯æ˜¾ç¤ºå¼‚å¸¸
1. ç¡®è®¤distç›®å½•æ–‡ä»¶å®Œæ•´ä¸Šä¼ 
2. æ£€æŸ¥Nginxé™æ€æ–‡ä»¶é…ç½®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### APIè¯·æ±‚å¤±è´¥ï¼ˆ502 Bad Gatewayï¼‰
1. **æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€**ï¼š
   ```bash
   # æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
   ps aux | grep python
   # æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«ç›‘å¬
   netstat -tlnp | grep 8000
   ```

2. **é‡å¯åç«¯æœåŠ¡**ï¼š
   ```bash
   # è¿›å…¥åç«¯ç›®å½•
   cd /www/server/deepseek-backend
   
   # åœæ­¢ç°æœ‰æœåŠ¡
   pkill -f "python3 run.py"
   
   # é‡æ–°å¯åŠ¨æœåŠ¡
   source venv/bin/activate && ENVIRONMENT=production python3 run.py &
   ```

3. **æ£€æŸ¥Nginxé”™è¯¯æ—¥å¿—**ï¼š
   ```bash
   tail -f /www/wwwlogs/deepseek.lbuding.com.error.log
   ```

4. **æµ‹è¯•åç«¯æœåŠ¡ç›´æ¥è®¿é—®**ï¼š
   ```bash
   # åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•åç«¯API
   curl http://127.0.0.1:8000/health
   curl http://127.0.0.1:8000/api/docs
   ```

5. **æ£€æŸ¥é˜²ç«å¢™è®¾ç½®**ï¼š
   - ç¡®ä¿8000ç«¯å£åœ¨æœåŠ¡å™¨å†…éƒ¨å¯è®¿é—®
   - æ£€æŸ¥å®å¡”é¢æ¿çš„å®‰å…¨ç»„/é˜²ç«å¢™è®¾ç½®

6. **éªŒè¯åŸŸåé…ç½®**
7. **é‡è¦**ï¼šç¡®ä¿å‰ç«¯ä½¿ç”¨æ­£ç¡®çš„APIåœ°å€ï¼ˆå·²é…ç½®ä¸ºä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨æŒ‡å‘https://deepseek.lbuding.com/apiï¼‰

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºä½¿ç”¨CDNåˆ†å‘
2. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†é…ç½®æµè§ˆå™¨ç¼“å­˜
3. **å‹ç¼©ä¼˜åŒ–**ï¼šå¯ç”¨Gzipå‹ç¼©
4. **å›¾ç‰‡ä¼˜åŒ–**ï¼šä½¿ç”¨WebPæ ¼å¼å›¾ç‰‡

## ğŸ”’ å®‰å…¨é…ç½®

1. **é˜²ç«å¢™**ï¼šåªå¼€æ”¾80/443ç«¯å£
2. **ç›®å½•ä¿æŠ¤**ï¼šç¦æ­¢è®¿é—®.envç­‰æ•æ„Ÿæ–‡ä»¶
3. **HTTPSå¼ºåˆ¶**ï¼šå¯ç”¨HSTS
4. **å®šæœŸå¤‡ä»½**ï¼šæ•°æ®åº“å’Œæ–‡ä»¶å®šæœŸå¤‡ä»½

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. å®å¡”é¢æ¿æ—¥å¿—
2. åç«¯æœåŠ¡æ—¥å¿—
3. æµè§ˆå™¨å¼€å‘è€…å·¥å…·
4. æœåŠ¡å™¨ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

---
**éƒ¨ç½²å®Œæˆæ—¶é—´**ï¼š$(date)
**éƒ¨ç½²ç‰ˆæœ¬**ï¼šv1.0.0
**æŠ€æœ¯æ”¯æŒ**ï¼šè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜